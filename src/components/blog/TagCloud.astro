---
import { tagToUrl } from "@utils/tags";

interface TagData {
  name: string;
  count: number;
}

interface Props {
  tags: TagData[];
  /** Minimum font size in rem */
  minSize?: number;
  /** Maximum font size in rem */
  maxSize?: number;
}

const { tags, minSize = 0.85, maxSize = 1.75 } = Astro.props;

// Calculate font sizes based on frequency
const counts = tags.map((t) => t.count);
const minCount = Math.min(...counts);
const maxCount = Math.max(...counts);
const range = maxCount - minCount || 1;

function getFontSize(count: number): number {
  const normalized = (count - minCount) / range;
  return minSize + normalized * (maxSize - minSize);
}

function getWeight(count: number): number {
  const normalized = (count - minCount) / range;
  // Scale from 400 to 600
  return Math.round(400 + normalized * 200);
}
---

<div class="tag-cloud">
  {
    tags.map(({ name, count }) => (
      <a
        href={tagToUrl(name)}
        class="tag-cloud-item"
        style={`font-size: ${getFontSize(count)}rem; font-weight: ${getWeight(count)};`}
        title={`${count} ${count === 1 ? "post" : "posts"}`}
      >
        {name}
        <span class="tag-count">{count}</span>
      </a>
    ))
  }
</div>

<style>
  @reference "tailwindcss";

  .tag-cloud {
    @apply flex flex-wrap items-center justify-center gap-3;
  }

  .tag-cloud-item {
    @apply inline-flex items-center gap-1.5 rounded-full px-4 py-2 no-underline;
    background-color: var(--color-surface);
    color: var(--color-text);
    border: 1px solid var(--color-border);
    transition:
      transform 0.2s ease,
      background-color 0.2s ease,
      border-color 0.2s ease,
      color 0.2s ease;
  }

  .tag-cloud-item:hover {
    transform: scale(1.05);
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .tag-count {
    @apply ml-1 rounded-full px-1.5 py-0.5 text-xs;
    background-color: var(--color-bg);
    color: var(--color-muted);
    font-weight: 500;
  }
</style>
