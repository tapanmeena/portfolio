---
import { Moon, Sun, Search, Menu, X } from "@lucide/astro";

const pathname = Astro.url.pathname;
const navLinks = [
  { href: "/blog", label: "Blog" },
  { href: "/projects", label: "Projects" },
  { href: "/about", label: "About" },
  { href: "/contact", label: "Contact" },
];
---

<header id="site-header" class="site-header fixed z-50 transition-all duration-500">
  <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
    <!-- Logo -->
    <a href="/" class="logo group flex items-center gap-2 no-underline">
      <span class="logo-monogram">TM</span>
      <span class="logo-text">Tapan Meena</span>
    </a>

    <!-- Desktop nav -->
    <nav class="nav-desktop hidden md:flex gap-1">
      {
        navLinks.map((link) => (
          <a href={link.href} class:list={["nav-link", { active: pathname.startsWith(link.href) }]}>
            {link.label}
          </a>
        ))
      }
    </nav>

    <!-- Actions -->
    <div class="flex items-center gap-2">
      <!-- Search button -->
      <button id="search-btn" aria-label="Search" class="icon-btn">
        <Search size={18} />
      </button>

      <!-- Theme Toggle -->
      <button id="theme-toggle" aria-label="Toggle theme" class="icon-btn theme-toggle">
        <Sun
          class="absolute transition-all duration-300 text-amber-500 opacity-100 rotate-0 scale-100 dark:opacity-0 dark:rotate-90 dark:scale-75"
          size={18}
        />
        <Moon
          class="absolute transition-all duration-300 text-indigo-300 opacity-0 -rotate-90 scale-75 dark:opacity-100 dark:rotate-0 dark:scale-100"
          size={18}
        />
      </button>

      <!-- Mobile Menu Toggle -->
      <button id="menu-toggle" aria-label="Toggle menu" aria-expanded="false" class="icon-btn md:hidden">
        <Menu size={20} class="menu-open-icon" />
        <X size={20} class="menu-close-icon" />
      </button>
    </div>
  </div>

  <!-- Mobile nav -->
  <nav id="mobile-nav" class="mobile-nav md:hidden">
    {
      navLinks.map((link) => (
        <a href={link.href} class:list={["mobile-nav-link", { active: pathname.startsWith(link.href) }]}>
          {link.label}
        </a>
      ))
    }
  </nav>
</header>

<script is:inline>
  const header = document.getElementById("site-header");
  const menuToggle = document.getElementById("menu-toggle");
  const mobileNav = document.getElementById("mobile-nav");

  const getScrollThreshold = () => (window.innerWidth < 600 ? 32 : 64);

  const onScroll = () => {
    header.classList.toggle("is-scrolled", window.scrollY > getScrollThreshold());
  };

  window.addEventListener("scroll", onScroll, { passive: true });
  window.addEventListener("resize", onScroll, { passive: true });

  // Theme toggle
  document.getElementById("theme-toggle").addEventListener("click", () => {
    const isDark = document.documentElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  // Mobile menu toggle
  menuToggle.addEventListener("click", () => {
    const isOpen = mobileNav.classList.toggle("menu-open");
    menuToggle.classList.toggle("menu-open");
    menuToggle.setAttribute("aria-expanded", isOpen);
  });

  // Close mobile menu on link click
  mobileNav.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      mobileNav.classList.remove("menu-open");
      menuToggle.classList.remove("menu-open");
      menuToggle.setAttribute("aria-expanded", "false");
    });
  });
</script>

<style>
  @reference "tailwindcss";

  @layer components {
    /* Header base */
    .site-header {
      @apply top-0 left-0 w-full bg-transparent;
    }

    /* Glass header on scroll */
    .site-header.is-scrolled {
      @apply top-4
        left-4
        w-[calc(100%-32px)]
        rounded-[18px]
        shadow-sm
        backdrop-blur
        backdrop-saturate-150
        transition-all;

      background-color: var(--color-surface);
      @apply bg-black/25 dark:bg-(--color-surface)/20;
    }

    /* LOGO */
    .logo {
      color: var(--color-text);
    }

    .logo-monogram {
      @apply flex h-8 w-8 items-center justify-center
      rounded-lg
      bg-linear-to-br from-blue-500 to-sky-700
      text-xs font-bold text-white
      transition-transform
      group-hover:scale-105;
    }

    .logo-text {
      @apply text-lg font-bold hidden sm:inline;
      color: var(--color-text);
    }

    /* Desktop nav */
    .nav-link {
      @apply relative px-3 py-2 text-sm font-medium
      rounded-lg
      transition-colors;
      color: var(--color-text);
    }

    .nav-link:hover {
      color: var(--color-accent);
      background-color: var(--color-surface);
    }

    .nav-link.active {
      color: var(--color-accent);
      font-weight: 600;
    }

    .nav-link.active::after {
      content: "";
      @apply absolute bottom-0 left-1/2 -translate-x-1/2
      h-0.5 w-4 rounded-full
      bg-blue-500 dark:bg-blue-400;
    }

    /* icon buttons */
    .icon-btn {
      @apply relative flex h-9 w-9 items-center justify-center
        rounded-full
        border border-gray-600 dark:border-gray-300
        text-gray-600 dark:text-gray-300
        backdrop-blur
        transition
        hover:scale-105
        hover:text-gray-900 dark:hover:text-white;
    }

    /* Mobile menu button icons */
    .menu-close-icon {
      @apply hidden;
    }

    .menu-open .menu-open-icon {
      @apply hidden;
    }

    .menu-open .menu-close-icon {
      @apply block;
    }

    /* Mobile nav */
    .mobile-nav {
      @apply max-h-0 overflow-hidden
      px-4
      transition-all duration-300 ease-in-out;
    }

    .mobile-nav.menu-open {
      @apply max-h-64 pb-4;
    }

    .mobile-nav-link {
      @apply block py-3 px-4
      text-base font-medium
      text-gray-600 dark:text-gray-300
      border-b border-gray-100 dark:border-white/10
      transition-colors
      hover:text-gray-900 dark:hover:text-white
      hover:bg-gray-50 dark:hover:bg-white/5
      rounded-lg;
    }

    .mobile-nav-link:last-child {
      @apply border-b-0;
    }

    .mobile-nav-link.active {
      @apply text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-500/10;
    }
  }
</style>
